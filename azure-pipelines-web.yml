trigger:
  - master

jobs:
  - job: ubuntu
    pool:
      vmImage: ubuntu-latest
      name: BKTPAY UAT Agents
      demands:
        - Agent.Name -equals  azure-devops-agent2-898fbc4bb-9zn2c


    steps:
    
       - script: |
          sudo apt-get update
          sudo apt -y install xvfb 
          sudo apt install openjdk-17-jdk openjdk-17-jre
          curl -O https://download.katalon.com/9.7.0/Katalon_Studio_Engine_Linux_64-9.7.0.tar.gz
          tar -xzf Katalon_Studio_Engine_Linux_64-9.7.0.tar.gz
          ls
          pwd
          cd Katalon_Studio_Engine_Linux_64-9.7.0
          ls
          chmod +x katalonc
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo dpkg -i google-chrome-stable_current_amd64.deb
          sudo apt-get install -f
          xvfb-run --server-args="-screen 0, 1024x768x24" ./katalonc -noSplash -runMode=console  -retry=0  -testSuitePath="Test Suites/Test_Suite_Web" -projectPath="/azp/_work/1/s" -browserType="Chrome (headless)" -executionProfile="default" -apiKey="f3ab2f6b-d373-4618-b87c-7471b31a5506" --config -proxy.auth.option=NO_PROXY -proxy.system.option=NO_PROXY -proxy.system.applyToDesiredCapabilities=true  -webui.autoUpdateDrivers=true -logLevel=INFO
         continueOnError: true  

       - task: PublishPipelineArtifact@1
         displayName: 'Publish Pipeline Artifact'
         inputs:
            targetPath: $(Pipeline.Workspace)
            artifact: katalon
         continueOnError: true
